> Heterogeneous Graph Neural Networks for Malicious Account Detection
> CIKM 2018

## ABSTRACT
论文提出了叫GEM的方法，这是一种使用异构图神经网络来检测支付宝恶意账户的方法。从连接子图得到启发，自适应的来学习基于攻击者设备聚集和行为聚集的异构的账户-设备图中的节点表示。对于异构图，它由多种类型节点组成，论文提出了一种注意力机制来学习不同类型节点的权重。相比于其他的方法，论文方法有不错的表现。
**KEYWORDS：Malicious account detection; neural graph networks; heterogeneous graphs**

## INTRODUCTION
像Gmail、Facebook、支付宝这些系统，都是黑产的攻击对象。通过申请大量的账号，可以传播垃圾信息、获取灰色收入。所以高效且准确的识别恶意账户在上述系统中扮演了重要的角色。
现有的恶意账户识别的方法主要有三种：1）基于规则的方法，通过制定复杂的规则来区分；2）基于图的方法，这种方法充分考虑了账户之间的关系连接；3）基于机器学习的方法，使用大量数据来训练策略模型。
一个优秀的策略系统必须能够有效应对不断变化的潜在攻击。攻击者一般会有两个主要的基础特征，1）设备聚集性，攻击者受限于攻击成本，必然会出现多账号共用设备的情况；2）活动聚集性，攻击者都是有一定目的的，有限时间内恶意账号的行为与正常账户存在差异。虽然攻击者的弱点已经很明显了，但是要确保高准确、高召回的指标依然是富有挑战性的，特别是在金融风控中。
本文提出的GEM是一种新的基于图的图表示学习方法，通过异构图来综合考虑『设备聚集性』和『活动聚集性』，本质上即是对异构的账户-设备图的拓扑结构进行建模，并考虑到了图结构中账户的行为特征。模型通过注意力机制学习不同设备的权重，不同于其他模型，本文模型会学习一个函数，是一种将账户的上下文拓扑关系和最近的行为特征输入的端到端的方法。模型被实际应用到支付宝系统中，每天可以检测出数万恶意账户。

## PRELIMINARIES

这里先介绍一些基本知识和图表示学习近况。

### Graph Neural Networks

GNNs可以用来预测一个图中节点或者边的类别。新的研究也有将GNNs作为一种基础神经网络来递归处理更一般的图，比如循环图、有向图、无向图。通过将卷积操作泛化到图上的方法的结果令人兴奋。一个无向图 $\mathcal{G} =\{\mathcal{V},\mathcal{E}\}$，所有$N$个节点$v_i \in \mathcal{V}$，边$(v_i,v_j) \in \mathcal{E}$，节点特征$X \in R^{N,D}$和邻接矩阵$A \in R^{N \times N}$，卷积层如下所示：

事实上，GCN训练的过程可以看做是学习一个函数$f(X,A)$通过节点的邻居信息来生成节点$x_i$的向量表示。前人的研究显示，我们总能找到一个等式将给定的定点等式转换到另一个特征空间。因此，我们可以直接用神经网络在特定的嵌入空间$h$中学习图模型并直接通过相关的连接优化函数$f$。这种方式是变量限制在一个指数函数范围，效果甚至比传统模型更好。即学习一个迭代式的邻居聚合函数：
​
这里的$f(\cdot)$是一个参数化的非线性转换函数。该领域很多关于接收域的研究是有道理的，类比于图片中像素点有8个相邻的像素点，图中的节点有更多邻居信息。
Node Embedding
第二部分技术主要是图表示学习，学习节点的富含图结构信息的表示。有直接使用邻接矩阵的、$t$ 阶邻接矩阵或者是使用随机游走来抽取高阶信息。基本上所有方法都是在优化一个经验损失$\mathcal{L}$:

$f_{enc}$  是编码器， $f_{dec}$ 是解码器， $f_{\mathcal{G}}$ 是关系对近似函数；$ \mathcal{l}$ 是来衡量$ f_{dec} $重构能力的损失函数，$ f_{enc} $近似于用户指定的组对儿的 $f_{\mathcal{G}} $值。
这些方法都是无监督学习的算法，表示向量放入分类器才可以得到最终的预测。此外，基于随机游走的近似度量在这个领域得到了广泛应用，文中也进行了相关的实验。

## THE PROPOSED APPROACHES

这部分主要介绍在支付宝的场景设计一种基于连接子图的方法。

### Data Analysis

首先看一下支付宝真实场景下的『设备聚集性』和『活动聚集性』。
『设备聚集性』：一个账号对应多个设备，或一小撮设备却被一大批账号登录，这些账号都是可疑的。
『行为聚集性』：一批账号有相同的批量行为。
下图是支付宝7天构建的账号设备图谱，显示出了上述两种模式特点。

### A Motivation: Subgraph Components
设备聚集和行为聚集的特点使得需要从图的角度来考虑恶意账号检测的问题。
第一步的尝试是一种称作关联子图的方法。最初的想法是构建一个账号图谱，寄希望于边关系可以联系出一众的账号。关联子图的方法主要由三部分构成：
1. 假设有一个图$ \mathcal{G}$ ，其节点$ N $包含账号和设备，边关系集合$ M $则是指账号$ i$ 在一段时间内在设备$ j $上的登录行为。基于此，可以构建一个包含账号节点的同构图，图中的一条边表示账号$ i $和账号$ i'$ 在一个时间段内使用了同一设备登录。因此，图$ \mathcal{G}$ 中的关联子图可以看做属于同一个组的账号。其中越大的团伙，其潜在的作弊风险也就越高。但是，实际使用中会自然而然的存在一定的噪声数据，比如不同账号使用相同IP登录是很正常的。
2. 进一步减少边关系。通常，一个团伙的账号往往会活跃在某个特定的时间点。为了衡量一个子图$ \mathcal{G}^{a}$ 中两个账号的相似性，通过把账号的行为使用一组向量来描述，即$ x_i=[x_{i,1}, ..., x_{i,p}]^T, (p=24)$ ，每个$ x_{i,t}$ 表示账号在第$ t $小时的行为频率。就可以通过向量内积来衡量两个账号的相似性。因此，可以进一步删除那些边关系两端节点相似性小于$ \theta $的，当然，这个$ \theta $是作为超参数来控制$ \mathcal{G}^{a}$ 的稀疏程度的。
3. 最后，可以通过账号所属子图的规模来对其进行打分。确定超参数$ \theta $，需要不断微调得到。
